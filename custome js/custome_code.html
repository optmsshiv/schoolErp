function updateFeeTable(feePlans) {
const months = [
'April',
'May',
'June',
'July',
'August',
'September',
'October',
'November',
'December',
'January',
'February',
'March'
];

// Get table elements
const theadRow = document.querySelector('#student_fee_table thead tr');
const tableBody = document.querySelector('#student_fee_table tbody');

// Clear existing table content
theadRow.innerHTML = '<th>Fee Head</th>'; // Add "Fee Head" column
tableBody.innerHTML = '';

// Generate table header dynamically
months.forEach(month => {
const th = document.createElement('th');
th.textContent = month;
theadRow.appendChild(th);
});

// Create a map to organize data by Fee Head and months
const feeDataMap = {};

feePlans.forEach(({ month_name, amount, fee_head_name }) => {
if (!feeDataMap[fee_head_name]) {
feeDataMap[fee_head_name] = new Array(months.length).fill('N/A');
}
const monthIndex = months.indexOf(month_name);
if (monthIndex !== -1) {
feeDataMap[fee_head_name][monthIndex] = amount;
}
});

let totalAmounts = new Array(months.length).fill(0); // Track total amount for each month

Object.entries(feeDataMap).forEach(([feeHeadName, monthAmounts]) => {
const row = document.createElement('tr');
row.classList.add('text-center');

// Add Fee Head column
const feeHeadCell = document.createElement('td');
feeHeadCell.textContent = feeHeadName;
row.appendChild(feeHeadCell);

// Add amount for each month
monthAmounts.forEach((amount, index) => {
const amountCell = document.createElement('td');
amountCell.textContent = amount !== 'N/A' ? amount : 'N/A';
row.appendChild(amountCell);

if (amount !== 'N/A' && !isNaN(amount)) {
totalAmounts[index] += parseFloat(amount);
}
});

tableBody.appendChild(row);
});

// Add "Total" row with amount buttons
const totalRow = document.createElement('tr');
totalRow.classList.add('text-center');

// Add "Total" cell
const totalFeeHeadCell = document.createElement('td');
totalFeeHeadCell.textContent = 'Total';
totalRow.appendChild(totalFeeHeadCell);

// Add total amounts for each month with a button
totalAmounts.forEach(totalAmount => {
const totalAmountCell = document.createElement('td');
totalAmountCell.innerHTML = `
<div class="amount-button">
  <div class="amount">${totalAmount > 0 ? totalAmount.toFixed(0) : 'N/A'}</div>
  <button class="btn btn-outline-primary rounded-circle">
    <i class="bx bx-plus"></i>
  </button>
</div>
`;
totalRow.appendChild(totalAmountCell);
});

tableBody.appendChild(totalRow);
}

<script src="/php/collectFeeStudentDetails/fetch_fee_month.php"> </script>



<?php
require 'db.php'; // Include your PDO database connection

if (!isset($_GET['user_id'])) {
    echo json_encode(["error" => "User ID is required"]);
    exit;
}

$user_id = $_GET['user_id'];

try {
    // Step 1: Get class_name from feeDetails
    $stmt = $pdo->prepare("SELECT class_name FROM feeDetails WHERE user_id = ? LIMIT 1");
    $stmt->execute([$user_id]);
    $classResult = $stmt->fetch(PDO::FETCH_ASSOC);

    if (!$classResult) {
        echo json_encode(["error" => "User class not found"]);
        exit;
    }

    $class_name = $classResult['class_name'];

    // Step 2: Get monthly_fee from FeePlans using class_name
    $stmt = $pdo->prepare("SELECT monthly_fee FROM FeePlans WHERE class_name = ?");
    $stmt->execute([$class_name]);
    $feePlan = $stmt->fetch(PDO::FETCH_ASSOC);

    if (!$feePlan) {
        echo json_encode(["error" => "Fee plan not found"]);
        exit;
    }

    $monthly_fee = $feePlan['monthly_fee'];

    // Step 3: Get paid months from feeDetails
    $stmt = $pdo->prepare("SELECT month FROM feeDetails WHERE user_id = ? AND status = 'paid'");
    $stmt->execute([$user_id]);
    $paidMonths = $stmt->fetchAll(PDO::FETCH_COLUMN); // Fetch only month values

    // Step 4: Return data
    echo json_encode([
        "class_name"   => $class_name,
        "monthly_fee"  => $monthly_fee,
        "paid_months"  => $paidMonths
    ]);
} catch (PDOException $e) {
    echo json_encode(["error" => $e->getMessage()]);
}
?>
